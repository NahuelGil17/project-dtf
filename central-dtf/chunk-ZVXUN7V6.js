import{$ as b,A as d,Bd as A,Dd as B,I as w,Jd as D,Oc as g,Pc as k,Rc as u,S as f,V as m,aa as S,j as s,k as l,ld as U,m as p,md as E,pd as M,rd as I,sd as C,td as P,wd as j}from"./chunk-LCVDR2E5.js";import{d as x,g as F}from"./chunk-LYCM6NQH.js";var L=(()=>{let e=class e{constructor(t){this.firestore=t,this._auth=S(E)}googleLogin(){return l(C(this._auth,new U))}register(t,a){return l(M(this._auth,t,a))}login(t,a){return l(I(this._auth,t,a))}logOut(){return l(P(this._auth))}createUserDoc(t,a){let o=D(A(this.firestore,"users",t.uid),{uid:t.uid,email:t.email,fullName:a.fullName,phoneNumber:a.phoneNumber,ci:a.ci});return l(o)}getUserPreferences(t){return l(B(A(this.firestore,"users",t)))}};e.\u0275fac=function(a){return new(a||e)(b(j))},e.\u0275prov=m({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var N=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Auth] Login";let r=e;return r})();var R=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Auth] Register";let r=e;return r})(),T=(()=>{let e=class e{};e.type="[Auth] Logout";let r=e;return r})(),v=(()=>{let e=class e{constructor(t){this.uid=t}};e.type="[Auth] Get User Preferences";let r=e;return r})();var h=x(F());var c,n=(c=class{constructor(){this.authService=S(L)}static currentUserId(e){return e.preferences?.uid}static authLoading(e){return e.loading}static accessToken(e){return e.auth?.idToken}static isAuthenticated(e){return!!e.auth?.idToken}static isAdmin(e){return e.preferences?.isAdmin??!1}static preferences(e){return e.preferences}login(e,i){e.patchState({loading:!0});let{email:t,password:a}=i.payload;return this.authService.login(t,a).pipe(f(o=>{e.patchState({auth:o._tokenResponse,preferences:o.user}),e.patchState({loading:!1}),h.default.fire({position:"top-end",heightAuto:!0,icon:"success",title:"Sesi\xF3n iniciada con \xE9xito",showConfirmButton:!1,timer:1500})}),w(o=>e.dispatch(new v(o.user.uid))),d(o=>{let y=this.getErrorMessage(o);return h.default.fire({position:"top-end",heightAuto:!0,icon:"error",title:"Error al iniciar sesi\xF3n",validationMessage:y,showConfirmButton:!1,timer:1500}),e.patchState({loading:!1}),p(()=>o)}))}logout(e){e.setState({auth:null,loading:!1,preferences:null}),this.authService.logOut().pipe(f(()=>{sessionStorage.clear(),localStorage.clear()}),d(i=>p(()=>i)))}register(e,i){e.patchState({loading:!0});let{email:t,password:a}=i.payload;return this.authService.register(t,a).pipe(f(o=>{e.patchState({loading:!1}),this.authService.createUserDoc(o.user,i.payload),h.default.fire({position:"top-end",icon:"success",title:"Usuario registrado con \xE9xito",showConfirmButton:!1,timer:1500})}),d(o=>{e.patchState({loading:!1});let y=this.getErrorMessage(o);return h.default.fire({position:"top-end",icon:"error",title:"Error al actualizar tabla",validationMessage:y,showConfirmButton:!1,timer:1500}),p(()=>o)}))}getUserPreferences(e,i){return e.patchState({loading:!0}),this.authService.getUserPreferences(i.uid).pipe(f(t=>{e.patchState({preferences:t.data()}),e.patchState({loading:!1})}),d(t=>{e.patchState({loading:!1});let a=this.getErrorMessage(t);return h.default.fire({position:"top-end",icon:"error",title:"Error al actualizar tabla",validationMessage:a,showConfirmButton:!1,timer:1500}),p(()=>t)}))}getErrorMessage(e){let i="An unknown error occurred!";if(e.code)switch(e.code){case"auth/email-already-in-use":i="Este correo electr\xF3nico ya est\xE1 en uso.";break;case"auth/user-disabled":i="Este usuario ha sido deshabilitado.";break;case"auth/user-not-found":i="Usuario no encontrado.";break;case"auth/wrong-password":i="Contrase\xF1a incorrecta.";break;case"auth/invalid-email":i="Correo electr\xF3nico inv\xE1lido.";break;case"auth/invalid-login-credentials":i="Credenciales invalidas.";break;case"auth/invalid-credential":i="Credenciales invalidas.";break}return i}},c.\u0275fac=function(i){return new(i||c)},c.\u0275prov=m({token:c,factory:c.\u0275fac,providedIn:"root"}),c);s([g(N,{cancelUncompleted:!0})],n.prototype,"login",null);s([g(T)],n.prototype,"logout",null);s([g(R,{cancelUncompleted:!0})],n.prototype,"register",null);s([g(v,{cancelUncompleted:!0})],n.prototype,"getUserPreferences",null);s([u()],n,"currentUserId",null);s([u()],n,"authLoading",null);s([u()],n,"accessToken",null);s([u()],n,"isAuthenticated",null);s([u()],n,"isAdmin",null);s([u()],n,"preferences",null);n=s([k({name:"auth",defaults:{auth:null,loading:!1,preferences:null}})],n);export{N as a,R as b,T as c,n as d};
