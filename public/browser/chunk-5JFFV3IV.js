import{$ as b,A as d,Bd as A,Dd as B,I as w,Jd as D,Oc as g,Pc as k,Rc as l,S as f,V as S,aa as y,j as a,k as u,ld as U,m as p,md as M,pd as E,rd as I,sd as C,td as P,wd as j}from"./chunk-LCVDR2E5.js";import{d as x,g as F}from"./chunk-LYCM6NQH.js";var L=(()=>{let e=class e{constructor(t){this.firestore=t,this._auth=y(M)}googleLogin(){return u(C(this._auth,new U))}register(t,s){return u(E(this._auth,t,s))}login(t,s){return u(I(this._auth,t,s))}logOut(){return u(P(this._auth))}createUserDoc(t,s){let o=D(A(this.firestore,"users",t.uid),{uid:t.uid,email:t.email,fullName:s.fullName,phoneNumber:s.phoneNumber,ci:s.ci});return u(o)}getUserPreferences(t){return u(B(A(this.firestore,"users",t)))}};e.\u0275fac=function(s){return new(s||e)(b(j))},e.\u0275prov=S({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var N=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Auth] Login";let r=e;return r})();var R=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Auth] Register";let r=e;return r})(),T=(()=>{let e=class e{};e.type="[Auth] Logout";let r=e;return r})(),v=(()=>{let e=class e{constructor(t){this.uid=t}};e.type="[Auth] Get User Preferences";let r=e;return r})();var h=x(F());var c,n=(c=class{constructor(){this.authService=y(L)}static currentUserId(e){return e.preferences?.uid}static authLoading(e){return e.loading}static accessToken(e){return e.auth?.idToken}static isAuthenticated(e){return!!e.auth?.idToken}static isAdmin(e){return e.preferences?.isAdmin??!1}static preferences(e){return e.preferences}login(e,i){e.patchState({loading:!0});let{email:t,password:s}=i.payload;return this.authService.login(t,s).pipe(f(o=>{e.patchState({auth:o._tokenResponse,preferences:o.user}),e.patchState({loading:!1}),h.default.fire({position:"top-end",heightAuto:!0,icon:"success",title:"Sesi\xF3n iniciada con \xE9xito",showConfirmButton:!1,timer:1500})}),w(o=>e.dispatch(new v(o.user.uid))),d(o=>{let m=this.getErrorMessage(o);return h.default.fire({position:"top-end",heightAuto:!0,icon:"error",title:"Error al iniciar sesi\xF3n",validationMessage:m,showConfirmButton:!1,timer:1500}),e.patchState({loading:!1}),p(()=>o)}))}logout(e){e.setState({auth:null,loading:!1,preferences:null}),this.authService.logOut().pipe(f(()=>{sessionStorage.clear(),localStorage.clear()}),d(i=>p(()=>i)))}register(e,i){e.patchState({loading:!0});let{email:t,password:s}=i.payload;return this.authService.register(t,s).pipe(f(o=>{e.patchState({loading:!1}),this.authService.createUserDoc(o.user,i.payload),h.default.fire({position:"top-end",icon:"success",title:"Usuario registrado con \xE9xito",showConfirmButton:!1,timer:1500})}),d(o=>{e.patchState({loading:!1});let m=this.getErrorMessage(o);return h.default.fire({position:"top-end",icon:"error",title:m,validationMessage:m,showConfirmButton:!1,timer:1500}),p(()=>o)}))}getUserPreferences(e,i){return e.patchState({loading:!0}),this.authService.getUserPreferences(i.uid).pipe(f(t=>{e.patchState({preferences:t.data()}),e.patchState({loading:!1})}),d(t=>{e.patchState({loading:!1});let s=this.getErrorMessage(t);return h.default.fire({position:"top-end",icon:"error",title:s,validationMessage:s,showConfirmButton:!1,timer:1500}),p(()=>t)}))}getErrorMessage(e){let i="An unknown error occurred!";if(e.code)switch(e.code){case"auth/email-already-in-use":i="Este correo electr\xF3nico ya est\xE1 en uso.";break;case"auth/user-disabled":i="Este usuario ha sido deshabilitado.";break;case"auth/user-not-found":i="Usuario no encontrado.";break;case"auth/wrong-password":i="Contrase\xF1a incorrecta.";break;case"auth/invalid-email":i="Correo electr\xF3nico inv\xE1lido.";break;case"auth/invalid-login-credentials":i="Credenciales invalidas.";break;case"auth/invalid-credential":i="Credenciales invalidas.";break}return i}},c.\u0275fac=function(i){return new(i||c)},c.\u0275prov=S({token:c,factory:c.\u0275fac,providedIn:"root"}),c);a([g(N,{cancelUncompleted:!0})],n.prototype,"login",null);a([g(T)],n.prototype,"logout",null);a([g(R,{cancelUncompleted:!0})],n.prototype,"register",null);a([g(v,{cancelUncompleted:!0})],n.prototype,"getUserPreferences",null);a([l()],n,"currentUserId",null);a([l()],n,"authLoading",null);a([l()],n,"accessToken",null);a([l()],n,"isAuthenticated",null);a([l()],n,"isAdmin",null);a([l()],n,"preferences",null);n=a([k({name:"auth",defaults:{auth:null,loading:!1,preferences:null}})],n);export{N as a,R as b,T as c,n as d};
